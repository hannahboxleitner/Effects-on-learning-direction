---
title: "Reproducibility study: Effects of Learning Direction in Retrieval Practice on EFL Vocabulary Learning"
subtitle: "Based on data from Terai et al. (2021)"
authors: "Hannah Boxleitner, Beyhan Aliy"
date: last-modified
format:
  html:
    number-sections: true
    embed-resources: true
    fig-dpi: 300
---

# Chapter overview

This chapter is based on data published in:

-   Terai, Masato, Junko Yamashita, and Kelly E. Pasich. 2021. EFFECTS OF LEARNING DIRECTION IN RETRIEVAL PRACTICE ON EFL VOCABULARY LEARNING. Studies in Second Language Acquisition 43(5): 1116–1137. <https://doi.org/10.1017/S0272263121000346>.

This chapter will introduce the application of R in Second Language Acquisition research, using data from Terai et al. (2021). We will go through the entire data analysis pipeline, from importing the data (chapter ???) to running logistic regression models and visualizing results with it. By the end of this chapter, it should become clear how to conduct and interpret mixed-effects logistics regression models in R for experimental data.

# Introducing the study

In this chapter, we attempt to reproduce the results of a linguistics study by Terai et al. (2021). The study focuses on learning directions in pair-associated vocabulary learning: L2 to L1, where L2 words are used as stimuli and responses are given in L1, vs. L1 to L2. Opposed to studying practices, where both a target and the answer are simultaneously presented, pair-associated learning includes *retrieval*. Retrieval is defined as the process of accessing stored information and plays a crucial role in retaining a learned word in memory **(p. 1116-1117 - Literaturangabe?)**. Previous findings regarding the efficacy of the two types of learning directions are inconsistent. The study focuses on the relationship between L2 proficiency and the effectiveness of the two learning directions in paired-associate learning in L2 vocabulary acquisition, and follows two research questions: 1. Which learning direction is more effective for vocabulary acquisition, L1 to L2 learning or L2 to L1 learning? 2. How does L2 proficiency influence the effects of L2 to L1 and L1 to L2 learning?

Therefore, the authors established the hypotheses that there is no significant difference between the two learning directions and that the effect of learning direction depends on the learner’s L2 proficiency **(p. 1121-1122).**

# Retrieving the authors' data

We will use the authors' original data for our reproduction, which they have made openly accessible on IRIS, a free database for language research:

-   [Terai, M., Yamashita, J. & Pasich, K. E. (2021). Effects of Learning Direction in Retrieval Practice on EFL Vocabulary Learning. Studies in Second Language Acquisition. 43(5). 1116–1137)](https://www.iris-database.org/search/?s_publicationAPAInlineReference=Terai%20et%20al.%20(2021))

In this particular case, you cannot just access the data, but also the authors' R code. Our further reproduction will use this R code to investigate and interpret the statistical analysis and results presented in the paper.

The dataset (dataset1_ssla_20210313.csv) contains data for each participant and item. Each row includes:
Answer: whether the participant gave the correct answer (1 = correct, 0 = incorrect)
Test: test type (L1 Production or L2 Production)
Condition: learning direction (L2->L1 or L1->L2)
ID: participant identifier
ItemID: item (word) identifier
Vocab: vocabulary test score (L2 proficiency)


# Importing the data

Before importing the dataset and starting on our project, we need to load all the packages that we will need. Some of these packages may have to installed first **(maybe include textbook reference 13.10)**.

```{r}
#| label: setup
#| warning: false

# This chunk loads necessary libraries.

# Load libraries
library(here)
library(tidyverse)

```

Next, we can import the data. In contrast to the authors' approach in their code, we used the here package for importing the data. This package creates paths relative to the top-level directory and therefore makes it easier to reference files regardless of how they are organized inside a project.

```{r}
VocabularyA_L1production <- read.csv(file = here("data", "vocaA_L1pro_20210313.csv"))
VocabularyA_L2production <- read.csv(file = here("data", "vocaA_L2pro_20210313.csv"))
VocabularyB_L1production <- read.csv(file = here("data", "vocaB_L1pro_20210313.csv"))
VocabularyB_L2production <- read.csv(file = here("data", "vocaB_L2pro_20210313.csv"))

#First we will load the dataset
dat<-read.csv(file = here("data", "dataset1_ssla_20210313.csv"), header=T)

#Then, we need to convert the categorial variables we have to factors using the function as.factor()
dat$Test<-as.factor(dat$Test)
dat$Condition<-as.factor(dat$Condition)

#Next, we will contrast the coding (-0.5 vs. +0.5) for categorical predictors
c<-contr.treatment(2)
my.coding<-matrix(rep(1/2,2,ncol=1))
my.simple<-c-my.coding
print(my.simple)

contrasts(dat$Test)<-my.simple
contrasts(dat$Condition)<-my.simple

#And standardize vocabulary scores (centered and scaled)
dat$s.vocab<-scale(dat$Vocab)

##All these steps set up the dataset for modeling. Converting variables to factors and coding them with contrast ensures that they are interpreted correctly in the regression. Scaling the vocabulary scores helps with interaction terms.
```

# Descriptive statistics

```{r}
##Irgendwie finde ich hier seine Daten zu Vocabulary Size, Age und Years of Leaning nicht? Im R Code habe ich nichts zu der Tabelle "descriptive statistics of the participants" gefunden?? Falls du sie findest kann man das ja wirklich easy ausrechnen lassen etc..
```


# Effects of Learning Condition (Research Question 1)
```{r}
##Test Type & Learning Direction
# To test RQ1, we fit a logistic mixed-effects regression model predicting accuracy (Answer) from Test, Condition, and their interaction.

#First we install and load the packages we need, these seem to be from an older Rstudio version but they still work just fine!

<<<<<<< Updated upstream
install.packages("lme4", discrepancies = TRUE)
install.packages("effects", discrepancies = TRUE)
install.packages("emmeans", discrepancies = TRUE)
install.packages("phia", discrepancies = TRUE)
=======
## install.packages("lme4", discrepancies = TRUE)
## install.packages("effects", discrepancies = TRUE)
## install.packages("emmeans", discrepancies = TRUE)
## install.packages("phia", discrepancies = TRUE)
>>>>>>> Stashed changes
library(lme4) ##leading required package:Matrix
library(effects)
library(emmeans)
library(phia)


#Model with interaction
fit1<-glmer(Answer~Test+Condition+(1|ID)+(1|ItemID),family=binomial, data=dat, glmerControl(optimizer="bobyqa"))

summary(fit1)

#glmer() fits a generalized linear mixed-effects model
#Answer is a binary outcome 
#Test and Condition are fixed effects
#(1|ID) and (1|ItemID) are random intercepts for participants and items
```

# Effects of Learning Directions and L2 Proficiency (Research Question 2)

<<<<<<< Updated upstream
To answer the second research question: How does L2 proficiency influence the effects of L2 to L1 and L1 to L2 learning? (Hypothesis: effect of learning direction depends on Learner's L2 proficiency)...
=======
To answer the second research question: How does L2 proficiency influence the effects of L2 to L1 and L1 to L2 learning? (Hypothesis: effect of learning direction depends on Learner's L2 proficiency) two models were applied to explore the influence of L2 proficiency on the two types of learning.

The paper reports that the advantage flips by proficiency level (lower-proficiency learners tend to benefit more from L2->L1, higher proficiency from L1->L2).

The packages that are used here include dplyr for the function filter(), lme4 for the function glmer(), effects for the function allEffects(), and phia, for the function testInteractions().
>>>>>>> Stashed changes
```{r}
##L1 Production test

## With a second model the scores of the L1 production test were analyzed. This seccond model contained Learning Condition and Vocabulary Size (English proficiency) as explanatory variables and Accuracy of the L1 production test as the response variable (Terai et al. 2021 : 1127).

##First, for clarity, we load the data with the name dat1 -> L1 production:
dat1<-read.csv(file = here("data", "dataset1_ssla_20210313.csv"), header=T)

##With the filter(...) function we only keep the rows for the L1 Production posttests, because we will analyze this test separately from the L2 production test.
dat1.L1<-filter(dat1, Test=="L1 Production")

#Make the categorical factors factorial: this means qualitative data is encoded into numeric data so that we can work with it and use the data for statistical analysis.. "condition" also encodes learning direction.
dat1.L1$Condition<-as.factor(dat1.L1$Condition)
  
#In the next step we change our coding so the variables are correct and not still working with the data from previous tests. 
c<-contr.treatment(2)
my.coding<-matrix(rep(1/2,2,ncol=1))
my.simple<-c-my.coding
print(my.simple)
#contr.treatment(2) starts with treatment coding(?) for a 2-level factor, and then the next two lines subtract a column of 0.5s, creating a simple (meaning centered) contrast:
##  2
## 0.5
##-0.5

##makes main effects easier to interpret and reduces collinearity in interaction models (so wie ich es verstanden habe????)
contrasts(dat1.L1$Condition)<-my.simple

#Scaling the Score: Here Vocab scores (L2 proficiency measures) are converted to z-scores
dat1.L1$vocab<-scale(dat1.L1$Vocab)

#without interaction ERKLÄREN NOCH?? 
fit2<-glmer(Answer~s.vocab+Condition+(1|ID)+(1|ItemID), family=binomial, data=dat1.L1, glmerontrol(optimizer="bobyqa"))
summary(fit2)


options(digits=7)
AIC(fit2)
#This command prints AIC, a fit index (the lower the better)


fit2.1<-glmer(Answer~s.vocab*Condition+(1|ID)+(1|ItemID), 
              family=binomial, data=dat1.L1, 
              glmerControl(optimizer="bobyqa"))
summary(fit2.1)
##addition of s.vocab:Condition which directly tests RQ2: Does the effect of learning direction depend on L2 proficiency? -> here s.vocab:Condition2 is negative and significant (-0.367, p=.009)

confint(fit2.1)

AIC(fit2.1)
anova(fit2,fit2.1)
##Model comparison: AIC is lower for the interaction model; the LR test is significant, so the interaction model fits better???

##Visualization of the interaction:
plot(allEffects(fit2.1), multiline=T, ci.style="bands",
    xlab="Vocabulary Size", ylab="Accuracy Rate",
    main="L1 Production", lty=c(1,2),
    rescale.axis=F, ylim = c(0,1), colors="black", asp=1)



##Repeat entire process for L2 Production Test
##withut Interaction I think
##hilfe


##Warning und FEHLER weil ich glaub ich die Daten nicht richtig abgespeichert habe, ich ändere das noch + ich muss hiervor das ganze Zeug (Codierung) einfügen bevor alles klappt glaube ich

```

# Conclusion

- No overall difference in accuracy between L1 -> L2 and L2 -> L1 learning (RQ1)
- A significant interaction between learning direction and L2 proficiency for L1 production scores (RQ2)
  - lower-proficiency learners benefited more from L2->L1 learning
  - higher-proficiency learners benefited more from L1->L2 learning
  
Statistical takeaway (maybe???): Mixed-effects logistic regression allows us to model data with both fixed effects (e.g. condition) and random effects (e.g. participant and item variability)
